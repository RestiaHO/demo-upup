"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[268],{9268:function(t,s,e){e.r(s),e.d(s,{default:function(){return c}});var o=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"login-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"登录"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(s){return t.$router.back()}},slot:"left"})],1),e("van-form",{ref:"loginForm",on:{submit:t.onSubmit}},[e("van-field",{attrs:{label:"手机号",placeholder:"请输入手机号",clearable:"",rules:t.userFormRules.mobile,name:"mobile"},model:{value:t.user.mobile,callback:function(s){t.$set(t.user,"mobile",s)},expression:"user.mobile"}},[e("i",{staticClass:"toutiao toutiao-shouji",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("van-field",{attrs:{type:"password",label:"密码",placeholder:"请输入验证码",rules:t.userFormRules.code},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"toutiao toutiao-yanzhengma"})]},proxy:!0},{key:"button",fn:function(){return[t.isCountDownShow?e("van-count-down",{attrs:{time:5e3,format:"ss s"},on:{finish:function(s){t.isCountDownShow=!1}}}):e("van-button",{staticClass:"send-sms-btn",attrs:{"native-type":"button",round:"",size:"small",type:"default"},on:{click:function(s){return t.onSendSms()}}},[t._v(" 发送验证")])]},proxy:!0}]),model:{value:t.user.code,callback:function(s){t.$set(t.user,"code",s)},expression:"user.code"}}),e("div",{staticClass:"login-btn-wrap"},[e("van-button",{staticClass:"login-btn",attrs:{block:"",type:"info","native-type":"submit"}},[t._v("登录")])],1)],1)],1)},a=[],n=e(5755),i={name:"LoginPage",data(){return{user:{mobile:"",code:""},userFormRules:{mobile:[{required:!0,message:"手机号不能为空"},{pattern:/^1[3|5|7|8]\d{9}$/,message:"手机号格式错误"}],code:[{required:!0,message:"验证码不能为空"},{pattern:/^\d{6}$/,message:"验证码格式错误"}]},isCountDownShow:!1}},methods:{async onSubmit(){this.$toast.loading({duration:0,forbidClick:!0,message:"登录中..."});const t=this.user;try{const s=await(0,n.UO)(t);console.log("登录成功",s),this.$store.commit("setUser",s.data.data),this.$toast.success("登录成功")}catch(s){400===s.response.status?console.log("手机号或验证码错误",s):console.log("登录失败，稍后重试",s),this.$toast.fail("登录失败，手机号或验证码错误")}this.$router.back()},async onSendSms(){try{await this.$refs.loginForm.validate("mobile")}catch(t){return console.log("验证失败",t)}this.isCountDownShow=!0;try{await(0,n.p1)(this.user.mobile),this.$toast("发送成功")}catch(t){this.isCountDownShow=!1,429===t.response.status?this.$toast("发送太频繁了，请稍后重试"):this.$toast("发送失败，请稍后重试")}}}},r=i,l=e(1001),u=(0,l.Z)(r,o,a,!1,null,"1aed2420",null),c=u.exports}}]);
//# sourceMappingURL=268.59e906d3.js.map