"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[672],{2672:function(t,e,s){s.r(e),s.d(e,{default:function(){return T}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home-container"},[s("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[s("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search",to:"/search"},slot:"title"},[t._v("搜索")])],1),s("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return s("van-tab",{key:t.id,attrs:{title:t.name}},[s("article-list",{attrs:{channel:t}})],1)})),s("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),s("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChennelEditShow=!0}},slot:"nav-right"},[s("i",{staticClass:"toutiao toutiao-gengduo"})])],2),s("van-popup",{staticClass:"edit-channel-popup",style:{height:"100%"},attrs:{position:"bottom",closeable:"","close-icon-position":"top-left"},model:{value:t.isChennelEditShow,callback:function(e){t.isChennelEditShow=e},expression:"isChennelEditShow"}},[s("channal-edit",{attrs:{myChannels:t.channels,active:t.active},on:{"update-active":t.onUpdateActive}})],1)],1)},n=[],i=s(5755),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"article-list"},[s("van-pull-refresh",{attrs:{"success-text":t.refreshSuccessText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isreFreshLoading,callback:function(e){t.isreFreshLoading=e},expression:"isreFreshLoading"}},[s("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载","finished-text":"没有更多了"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,e){return s("article-item",{key:e,attrs:{article:t}})})),1)],1)],1)},r=[],c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell",{staticClass:"article-item",attrs:{to:"/article/"+t.article.art_id},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"title van-multi-ellipsis--l2"},[t._v(t._s(t.article.title))])]},proxy:!0},{key:"label",fn:function(){return[3===t.article.cover.type?s("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,e){return s("div",{key:e,staticClass:"cover-item"},[s("van-image",{staticClass:"right-color",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),s("div",{staticClass:"label-info-wrap"},[s("span",[t._v(t._s(t.article.aut_name))]),s("span",[t._v(t._s(t.article.comm_count)+"评论")]),s("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]},proxy:!0},1===t.article.cover.type?{key:"default",fn:function(){return[s("van-image",{staticClass:"right-color",attrs:{fit:"cover",src:t.article.cover.images[0]}})]},proxy:!0}:null],null,!0)})},o=[],h={name:"ArticleItem",props:{article:{type:Object,default:()=>({})}}},d=h,u=s(1001),m=(0,u.Z)(d,c,o,!1,null,"11be470e",null),v=m.exports,p={name:"ArticleList",components:{ArticleItem:v},props:{channel:{type:Object,default:()=>({})}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isreFreshLoading:!1,refreshSuccessText:"刷新成功"}},methods:{async onLoad(){try{const{data:t}=await(0,i.VW)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()});console.log(t),this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.error=!0,this.loading=!1,console.log(t)}},async onRefresh(){try{const{data:t}=await(0,i.VW)({channel_id:this.channel.id,timestamp:Date.now()});this.list.unshift(...t.data.results),this.isreFreshLoading=!1,this.refreshSuccessText=`刷新成功，更新了${t.data.results.length}条数据`}catch(t){this.refreshSuccessText="刷新失败",this.isreFreshLoading=!1}}}},C=p,f=(0,u.Z)(C,l,r,!1,null,"641f931d",null),y=f.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"channel-edit"},[s("van-cell",{attrs:{border:!1}},[s("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),s("van-button",{staticClass:"edit-btn",attrs:{size:"mini",round:"",type:"danger",plain:""},on:{click:function(e){t.isEditShow=!t.isEditShow}}},[t._v(" "+t._s(t.isEditShow?"完成":"编辑")+" ")])],1),s("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(e,a){return s("van-grid-item",{key:a,staticClass:"channel-item",on:{click:function(s){return t.onMyChannelClick(e,a)}}},[s("span",{staticClass:"text",class:{active:t.active===a},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))]),s("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEditShow&&0!==a,expression:"isEditShow && index!==0"}],attrs:{slot:"icon",name:"close"},slot:"icon"})],1)})),1),s("van-cell",{attrs:{border:!1}},[s("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),s("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels,(function(e){return s("van-grid-item",{key:e.id,staticClass:"channel-item",attrs:{text:e.name,icon:"plus"},on:{click:function(s){return t.onAddChannel(e)}}})})),1)],1)},_=[],b=s(4665),w=s(5922),x={name:"ChannelEdit",props:{myChannels:{type:Array,default:()=>[]},active:{type:Number,default:0}},data(){return{myChannelsClone:this.myChannels,allChannels:[],isEditShow:!1}},computed:{...(0,b.rn)(["user"]),recommendChannels(){const t=this.allChannels.filter((t=>!this.myChannels.find((e=>e.id===t.id))));return t}},created(){this.loadAllChannels()},methods:{async loadAllChannels(){try{const{data:t}=await(0,i.Of)();this.allChannels=t.data.channels,console.log(t.data)}catch(t){this.$toast("获取频道列表数据失败")}},async onAddChannel(t){if(this.myChannelsClone.push(t),this.user)try{await(0,i.gO)({id:t.id,seq:this.myChannels.length}),this.$toast("添加成功")}catch(e){this.$toast("保存失败")}else(0,w.LS)("TOUTIAO_CHANNELS",this.myChannels)},onMyChannelClick(t,e){if(this.isEditShow){if(0===e)return;this.myChannelsClone.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e)},async deleteChannel(t){try{this.user?await(0,i.p0)(t.id):(0,w.LS)("TOUTIAO_CHANNELS",this.myChannels)}catch(e){console.log(e),this.$toast("删除频道失败，请稍后重试")}}}},S=x,k=(0,u.Z)(S,g,_,!1,null,"759bb78a",null),E=k.exports,A={name:"HomeIndex",components:{ArticleList:y,ChannalEdit:E},props:{},data(){return{active:0,channels:[],isChennelEditShow:!1}},computed:{...(0,b.rn)(["user"])},created(){this.loadChannels()},methods:{async loadChannels(){try{let t=[];const e=(0,w.rV)("TOUTIAO_CHANNELS");if(this.user||!e){const{data:t}=await(0,i.lS)();return this.channels=t.data.channels,!1}t=e,this.channels=t}catch(t){this.$toast("获取频道列表数据失败")}},onUpdateActive(t,e=!1){this.active=t,this.isChennelEditShow=e}}},L=A,$=(0,u.Z)(L,a,n,!1,null,"75e2ec2f",null),T=$.exports}}]);
//# sourceMappingURL=672.7849c27b.js.map