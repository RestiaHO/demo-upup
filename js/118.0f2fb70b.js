"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[118],{118:function(t,e,s){s.r(e),s.d(e,{default:function(){return X}});var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"article-container"},[s("van-nav-bar",{staticClass:"page-nav-bar",attrs:{"left-arrow":"",title:"黑马头条"}}),s("div",{staticClass:"main-wrap"},[t.loading?s("div",{staticClass:"loading-wrap"},[s("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?s("div",{staticClass:"article-detail"},[s("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),s("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[s("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),s("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),s("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))]),s("follow-user",{staticClass:"follow-btn",attrs:{"user-id":t.article.aut_id},on:{"update-follow":function(e){t.article.is_followed=e}},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1),s("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),s("van-divider",[t._v("正文结束")]),s("comment-list",{attrs:{articleId:t.article.art_id,commentList:t.commentList},on:{"onload-success":t.onloadSuccess,"reply-click":t.onReplyClick}}),s("div",{staticClass:"article-bottom"},[s("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")]),s("van-icon",{attrs:{name:"comment-o",info:t.totalCommentCount,color:"#777"}}),s("collect-article",{staticClass:"btn-item",attrs:{"article-id":t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),s("like-article",{staticClass:"btn-item",attrs:{"article-id":t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),s("van-icon",{attrs:{name:"share",color:"#777777"}})],1),s("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[s("comment-post",{attrs:{articleId:t.article.art_id},on:{"post-success":t.postSuccess}})],1)],1):404===t.errStatus?s("div",{staticClass:"error-wrap"},[s("van-icon",{attrs:{name:"failure"}}),s("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):s("div",{staticClass:"error-wrap"},[s("van-icon",{attrs:{name:"failure"}}),s("p",{staticClass:"text"},[t._v("内容加载失败！")]),s("van-button",{staticClass:"retry-btn",on:{click:function(e){return t.loadArtcileInfo()}}},[t._v("点击重试")])],1)]),s("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?s("comment-reply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},a=[],i=s(5755),n=s(993),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.isFollowed?s("van-button",{staticClass:"follow-btn",attrs:{type:"info",color:"#3296fa",round:"",size:"small",icon:"plus",loading:t.btnLoading},on:{click:function(e){return t.onFollow()}}},[t._v(" 关注 ")]):s("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.btnLoading},on:{click:function(e){return t.onFollow()}}},[t._v(" 已关注 ")])},c=[],r={name:"follow-user",model:{prop:"isFollowed",event:"update-follow"},props:{isFollowed:{type:Boolean,default:!1},userId:{type:String,default:""}},data(){return{btnLoading:!1}},methods:{async onFollow(){this.btnLoading=!0;try{this.isFollowed?await(0,i.YE)(this.userId):await(0,i.u5)(this.userId),this.$emit("update-follow",!this.isFollowed)}catch(t){console.log(t);let e="操作失败，请重试！";t.response&&400===t.response.status&&(e="你不能关注你自己！"),this.$toast(e)}this.btnLoading=!1}}},m=r,d=s(1001),u=(0,d.Z)(m,l,c,!1,null,"6a48cdad",null),h=u.exports,p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-button",{class:{collected:t.value},attrs:{icon:t.value?"star":"star-o",loading:t.loading},on:{click:t.onCollect}})},f=[],v={name:"CollectArticle",props:{value:{type:Boolean,default:!1},articleId:{type:String,default:""}},data(){return{loading:!1}},methods:{async onCollect(){this.loading=!0;try{this.value?await(0,i.u1)(this.articleId):await(0,i.$c)(this.articleId),this.$emit("input",!this.value),this.$toast.success(this.value?"取消收藏":"收藏成功")}catch(t){this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},_=v,C=(0,d.Z)(_,p,f,!1,null,"62a8f1b4",null),g=C.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-button",{class:{collected:1===t.value},attrs:{icon:1===t.value?"good-job":"good-job-o",loading:t.loading},on:{click:t.onCollect}})},w=[],y={name:"LikeArticle",props:{value:{type:Number,default:1},articleId:{type:String,default:""}},data(){return{loading:!1}},methods:{async onCollect(){this.loading=!0;try{let t=-1;1===this.value?await(0,i.nD)(this.articleId):(await(0,i.IF)(this.articleId),t=1),this.$emit("input",t),this.$toast.success(1===t?"点赞成功":"取消点赞")}catch(t){this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},k=y,S=(0,d.Z)(k,b,w,!1,null,"586fad17",null),I=S.exports,$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment-list"},[s("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"加载失败，请点击重试","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e,o){return s("comment-item",{key:o,attrs:{comment:e},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)],1)},L=[],x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell",{staticClass:"comment-item"},[s("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),s("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))]),s("van-button",{staticClass:"like-btn",class:{liked:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.commentLoading},on:{click:function(e){return t.onCommentLike(t.comment)}}},[t._v(t._s(t.comment.like_count||"赞"))])],1),s("div",{attrs:{slot:"label"},slot:"label"},[s("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),s("div",{staticClass:"bottom-info"},[s("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),s("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复 "+t._s(t.comment.reply_count))])],1)])],1)},P=[],A={name:"CommentItem",props:{comment:{type:Object,default:()=>({})}},data(){return{commentClone:this.comment,commentLoading:!1}},methods:{async onCommentLike(){this.commentLoading=!0;try{this.comment.is_liking?(await(0,i.IY)(this.comment.com_id),this.commentClone.like_count--):(await(0,i._7)(this.comment.com_id),this.commentClone.like_count++),this.commentClone.is_liking=!this.comment.is_liking}catch(t){this.$toast("操作失败，请重试")}this.commentLoading=!1}}},R=A,j=(0,d.Z)(R,x,P,!1,null,"70957bb2",null),E=j.exports,F={name:"CommentList",components:{CommentItem:E},props:{articleId:{type:String,default:""},commentList:{type:Array,default:()=>[]},type:{type:String,default:"a"}},data(){return{list:this.commentList,loading:!1,finished:!1,offset:null,totalCount:0,error:!1}},created(){this.loading=!0,this.onLoad()},methods:{async onLoad(){try{const{data:t}=await(0,i.nr)({type:this.type,source:this.articleId.toString(),offset:this.offset,limit:10});console.log(t),this.list.push(...t.data.results),this.totalCount=t.data.total_count,this.$emit("onload-success",t.data),this.loading=!1,t.data.results.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}}}},Z=F,z=(0,d.Z)(Z,$,L,!1,null,"88ffd002",null),T=z.exports,O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"post-comment"},[s("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"优质评论将会被优先展示","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),s("van-button",{staticClass:"post-btn",attrs:{size:"small",disabled:!t.message.length},on:{click:function(e){return t.onAddComment()}}},[t._v("发布")])],1)},B=[],D={name:"CommentPost",props:{articleId:{type:String,default:""}},inject:{articleIdPro:{type:String,default:""}},data(){return{message:""}},methods:{async onAddComment(){try{const t=this.message.trim();if(!t.length)return;const{data:e}=await(0,i.AD)({target:this.articleId,content:t,art_id:this.articleIdPro?this.articleIdPro.toString():""});this.message="",this.$emit("post-success",e.data),this.$toast.success("发布成功")}catch(t){this.$toast.fail("发布失败")}}}},N=D,Y=(0,d.Z)(N,O,B,!1,null,"79dba821",null),q=Y.exports,H=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("van-nav-bar",{attrs:{title:t.comment.reply_count>0?t.comment.reply_count+"条回复":"暂无回复"}},[s("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("close")}},slot:"left"})],1),s("div",{staticClass:"scroll-wrap"},[s("comment-item",{attrs:{comment:t.comment}}),s("van-cell",{attrs:{title:"全部回复"}}),s("comment-list",{attrs:{commentList:t.list,articleId:t.comment.com_id,type:"c"}}),s("div",{staticClass:"reply-bottom"},[s("van-button",{staticClass:"write-btn",attrs:{size:"small",round:""},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")])],1),s("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[s("comment-post",{attrs:{articleId:t.comment.com_id},on:{"post-success":t.postSuccess}})],1)],1)],1)},M=[],U={name:"CommentReply",components:{CommentItem:E,CommentList:T,CommentPost:q},props:{comment:{type:Object,default:()=>({})}},data(){return{commentClone:this.comment,list:[],isPostShow:!1}},methods:{postSuccess(t){this.commentClone.reply_count++,this.isPostShow=!1,console.log(this.list),this.list.unshift(t.new_obj)}}},G=U,J=(0,d.Z)(G,H,M,!1,null,"698d71fa",null),K=J.exports,Q={name:"ArticleIndex",components:{FollowUser:h,CollectArticle:g,LikeArticle:I,CommentList:T,CommentPost:q,CommentReply:K},props:{articleId:{type:[Number,String,Object],default:null}},data(){return{article:{},loading:!0,errStatus:0,btnLoading:!1,totalCommentCount:0,isPostShow:!1,commentList:[],isReplyShow:!1,currentComment:{}}},provide:function(){return{articleIdPro:this.articleId}},created(){this.loadArtcileInfo()},methods:{async loadArtcileInfo(){this.loading=!0;try{const{data:t}=await(0,i.rk)(this.articleId);this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404),this.$toast("获取失败")}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),s=[];e.forEach(((t,e)=>{s.push(t.src),t.onclick=()=>{(0,n.Z)({images:s,startPosition:e})}}))},onloadSuccess(t){this.totalCommentCount=t.total_count},postSuccess(t){this.isPostShow=!1,this.commentList.unshift(t.new_obj)},onReplyClick(t){this.currentComment=t,this.isReplyShow=!0}}},V=Q,W=(0,d.Z)(V,o,a,!1,null,"6477ce5d",null),X=W.exports}}]);
//# sourceMappingURL=118.0f2fb70b.js.map